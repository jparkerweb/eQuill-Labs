var Ar=Object.create;var ve=Object.defineProperty;var Sr=Object.getOwnPropertyDescriptor;var Tr=Object.getOwnPropertyNames;var Cr=Object.getPrototypeOf,Pr=Object.prototype.hasOwnProperty;var Rr=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports),xr=(o,i)=>{for(var c in i)ve(o,c,{get:i[c],enumerable:!0})},ut=(o,i,c,v)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of Tr(i))!Pr.call(o,d)&&d!==c&&ve(o,d,{get:()=>i[d],enumerable:!(v=Sr(i,d))||v.enumerable});return o};var Nr=(o,i,c)=>(c=o!=null?Ar(Cr(o)):{},ut(i||!o||!o.__esModule?ve(c,"default",{value:o,enumerable:!0}):c,o)),Or=o=>ut(ve({},"__esModule",{value:!0}),o);var dt=Rr((pt,Be)=>{(function(o){if(typeof pt=="object"&&typeof Be<"u")Be.exports=o();else if(typeof define=="function"&&define.amd)define([],o);else{var i;typeof window<"u"?i=window:typeof global<"u"?i=global:typeof self<"u"?i=self:i=this,i.localforage=o()}})(function(){var o,i,c;return function v(d,m,_){function A(C,O){if(!m[C]){if(!d[C]){var h=typeof require=="function"&&require;if(!O&&h)return h(C,!0);if(I)return I(C,!0);var w=new Error("Cannot find module '"+C+"'");throw w.code="MODULE_NOT_FOUND",w}var P=m[C]={exports:{}};d[C][0].call(P.exports,function(k){var F=d[C][1][k];return A(F||k)},P,P.exports,v,d,m,_)}return m[C].exports}for(var I=typeof require=="function"&&require,T=0;T<_.length;T++)A(_[T]);return A}({1:[function(v,d,m){(function(_){"use strict";var A=_.MutationObserver||_.WebKitMutationObserver,I;if(A){var T=0,C=new A(k),O=_.document.createTextNode("");C.observe(O,{characterData:!0}),I=function(){O.data=T=++T%2}}else if(!_.setImmediate&&typeof _.MessageChannel<"u"){var h=new _.MessageChannel;h.port1.onmessage=k,I=function(){h.port2.postMessage(0)}}else"document"in _&&"onreadystatechange"in _.document.createElement("script")?I=function(){var q=_.document.createElement("script");q.onreadystatechange=function(){k(),q.onreadystatechange=null,q.parentNode.removeChild(q),q=null},_.document.documentElement.appendChild(q)}:I=function(){setTimeout(k,0)};var w,P=[];function k(){w=!0;for(var q,$,M=P.length;M;){for($=P,P=[],q=-1;++q<M;)$[q]();M=P.length}w=!1}d.exports=F;function F(q){P.push(q)===1&&!w&&I()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(v,d,m){"use strict";var _=v(1);function A(){}var I={},T=["REJECTED"],C=["FULFILLED"],O=["PENDING"];d.exports=h;function h(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=O,this.queue=[],this.outcome=void 0,g!==A&&F(this,g)}h.prototype.catch=function(g){return this.then(null,g)},h.prototype.then=function(g,R){if(typeof g!="function"&&this.state===C||typeof R!="function"&&this.state===T)return this;var S=new this.constructor(A);if(this.state!==O){var D=this.state===C?g:R;P(S,D,this.outcome)}else this.queue.push(new w(S,g,R));return S};function w(g,R,S){this.promise=g,typeof R=="function"&&(this.onFulfilled=R,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(g){I.resolve(this.promise,g)},w.prototype.otherCallFulfilled=function(g){P(this.promise,this.onFulfilled,g)},w.prototype.callRejected=function(g){I.reject(this.promise,g)},w.prototype.otherCallRejected=function(g){P(this.promise,this.onRejected,g)};function P(g,R,S){_(function(){var D;try{D=R(S)}catch(U){return I.reject(g,U)}D===g?I.reject(g,new TypeError("Cannot resolve promise with itself")):I.resolve(g,D)})}I.resolve=function(g,R){var S=q(k,R);if(S.status==="error")return I.reject(g,S.value);var D=S.value;if(D)F(g,D);else{g.state=C,g.outcome=R;for(var U=-1,z=g.queue.length;++U<z;)g.queue[U].callFulfilled(R)}return g},I.reject=function(g,R){g.state=T,g.outcome=R;for(var S=-1,D=g.queue.length;++S<D;)g.queue[S].callRejected(R);return g};function k(g){var R=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof R=="function")return function(){R.apply(g,arguments)}}function F(g,R){var S=!1;function D(Y){S||(S=!0,I.reject(g,Y))}function U(Y){S||(S=!0,I.resolve(g,Y))}function z(){R(U,D)}var G=q(z);G.status==="error"&&D(G.value)}function q(g,R){var S={};try{S.value=g(R),S.status="success"}catch(D){S.status="error",S.value=D}return S}h.resolve=$;function $(g){return g instanceof this?g:I.resolve(new this(A),g)}h.reject=M;function M(g){var R=new this(A);return I.reject(R,g)}h.all=Ee;function Ee(g){var R=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=g.length,D=!1;if(!S)return this.resolve([]);for(var U=new Array(S),z=0,G=-1,Y=new this(A);++G<S;)K(g[G],G);return Y;function K(ie,ye){R.resolve(ie).then(Ae,function(ne){D||(D=!0,I.reject(Y,ne))});function Ae(ne){U[ye]=ne,++z===S&&!D&&(D=!0,I.resolve(Y,U))}}}h.race=te;function te(g){var R=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=g.length,D=!1;if(!S)return this.resolve([]);for(var U=-1,z=new this(A);++U<S;)G(g[U]);return z;function G(Y){R.resolve(Y).then(function(K){D||(D=!0,I.resolve(z,K))},function(K){D||(D=!0,I.reject(z,K))})}}},{1:1}],3:[function(v,d,m){(function(_){"use strict";typeof _.Promise!="function"&&(_.Promise=v(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(v,d,m){"use strict";var _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function A(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function I(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var T=I();function C(){try{if(!T||!T.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function O(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,s=new t,a=0;a<e.length;a+=1)s.append(e[a]);return s.getBlob(r.type)}}typeof Promise>"u"&&v(3);var h=Promise;function w(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function P(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function k(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function F(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var q="local-forage-detect-blob-support",$=void 0,M={},Ee=Object.prototype.toString,te="readonly",g="readwrite";function R(e){for(var r=e.length,t=new ArrayBuffer(r),s=new Uint8Array(t),a=0;a<r;a++)s[a]=e.charCodeAt(a);return t}function S(e){return new h(function(r){var t=e.transaction(q,g),s=O([""]);t.objectStore(q).put(s,"key"),t.onabort=function(a){a.preventDefault(),a.stopPropagation(),r(!1)},t.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function D(e){return typeof $=="boolean"?h.resolve($):S(e).then(function(r){return $=r,$})}function U(e){var r=M[e.name],t={};t.promise=new h(function(s,a){t.resolve=s,t.reject=a}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function z(e){var r=M[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function G(e,r){var t=M[e.name],s=t.deferredOperations.pop();if(s)return s.reject(r),s.promise}function Y(e,r){return new h(function(t,s){if(M[e.name]=M[e.name]||$e(),e.db)if(r)U(e),e.db.close();else return t(e.db);var a=[e.name];r&&a.push(e.version);var n=T.open.apply(T,a);r&&(n.onupgradeneeded=function(u){var l=n.result;try{l.createObjectStore(e.storeName),u.oldVersion<=1&&l.createObjectStore(q)}catch(f){if(f.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+u.oldVersion+" to version "+u.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw f}}),n.onerror=function(u){u.preventDefault(),s(n.error)},n.onsuccess=function(){var u=n.result;u.onversionchange=function(l){l.target.close()},t(u),z(e)}})}function K(e){return Y(e,!1)}function ie(e){return Y(e,!0)}function ye(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,a=e.version>e.db.version;if(s&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function Ae(e){return new h(function(r,t){var s=new FileReader;s.onerror=t,s.onloadend=function(a){var n=btoa(a.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},s.readAsBinaryString(e)})}function ne(e){var r=R(atob(e.data));return O([r],{type:e.type})}function Ue(e){return e&&e.__local_forage_encoded_blob}function St(e){var r=this,t=r._initReady().then(function(){var s=M[r._dbInfo.name];if(s&&s.dbReady)return s.dbReady});return P(t,e,e),t}function Tt(e){U(e);for(var r=M[e.name],t=r.forages,s=0;s<t.length;s++){var a=t[s];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,K(e).then(function(n){return e.db=n,ye(e)?ie(e):n}).then(function(n){e.db=r.db=n;for(var u=0;u<t.length;u++)t[u]._dbInfo.db=n}).catch(function(n){throw G(e,n),n})}function H(e,r,t,s){s===void 0&&(s=1);try{var a=e.db.transaction(e.storeName,r);t(null,a)}catch(n){if(s>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return h.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),ie(e)}).then(function(){return Tt(e).then(function(){H(e,r,t,s-1)})}).catch(t);t(n)}}function $e(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ct(e){var r=this,t={db:null};if(e)for(var s in e)t[s]=e[s];var a=M[t.name];a||(a=$e(),M[t.name]=a),a.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=St);var n=[];function u(){return h.resolve()}for(var l=0;l<a.forages.length;l++){var f=a.forages[l];f!==r&&n.push(f._initReady().catch(u))}var p=a.forages.slice(0);return h.all(n).then(function(){return t.db=a.db,K(t)}).then(function(y){return t.db=y,ye(t,r._defaultConfig.version)?ie(t):y}).then(function(y){t.db=a.db=y,r._dbInfo=t;for(var b=0;b<p.length;b++){var E=p[b];E!==r&&(E._dbInfo.db=t.db,E._dbInfo.version=t.version)}})}function Pt(e,r){var t=this;e=k(e);var s=new h(function(a,n){t.ready().then(function(){H(t._dbInfo,te,function(u,l){if(u)return n(u);try{var f=l.objectStore(t._dbInfo.storeName),p=f.get(e);p.onsuccess=function(){var y=p.result;y===void 0&&(y=null),Ue(y)&&(y=ne(y)),a(y)},p.onerror=function(){n(p.error)}}catch(y){n(y)}})}).catch(n)});return w(s,r),s}function Rt(e,r){var t=this,s=new h(function(a,n){t.ready().then(function(){H(t._dbInfo,te,function(u,l){if(u)return n(u);try{var f=l.objectStore(t._dbInfo.storeName),p=f.openCursor(),y=1;p.onsuccess=function(){var b=p.result;if(b){var E=b.value;Ue(E)&&(E=ne(E));var x=e(E,b.key,y++);x!==void 0?a(x):b.continue()}else a()},p.onerror=function(){n(p.error)}}catch(b){n(b)}})}).catch(n)});return w(s,r),s}function xt(e,r,t){var s=this;e=k(e);var a=new h(function(n,u){var l;s.ready().then(function(){return l=s._dbInfo,Ee.call(r)==="[object Blob]"?D(l.db).then(function(f){return f?r:Ae(r)}):r}).then(function(f){H(s._dbInfo,g,function(p,y){if(p)return u(p);try{var b=y.objectStore(s._dbInfo.storeName);f===null&&(f=void 0);var E=b.put(f,e);y.oncomplete=function(){f===void 0&&(f=null),n(f)},y.onabort=y.onerror=function(){var x=E.error?E.error:E.transaction.error;u(x)}}catch(x){u(x)}})}).catch(u)});return w(a,t),a}function Nt(e,r){var t=this;e=k(e);var s=new h(function(a,n){t.ready().then(function(){H(t._dbInfo,g,function(u,l){if(u)return n(u);try{var f=l.objectStore(t._dbInfo.storeName),p=f.delete(e);l.oncomplete=function(){a()},l.onerror=function(){n(p.error)},l.onabort=function(){var y=p.error?p.error:p.transaction.error;n(y)}}catch(y){n(y)}})}).catch(n)});return w(s,r),s}function Ot(e){var r=this,t=new h(function(s,a){r.ready().then(function(){H(r._dbInfo,g,function(n,u){if(n)return a(n);try{var l=u.objectStore(r._dbInfo.storeName),f=l.clear();u.oncomplete=function(){s()},u.onabort=u.onerror=function(){var p=f.error?f.error:f.transaction.error;a(p)}}catch(p){a(p)}})}).catch(a)});return w(t,e),t}function kt(e){var r=this,t=new h(function(s,a){r.ready().then(function(){H(r._dbInfo,te,function(n,u){if(n)return a(n);try{var l=u.objectStore(r._dbInfo.storeName),f=l.count();f.onsuccess=function(){s(f.result)},f.onerror=function(){a(f.error)}}catch(p){a(p)}})}).catch(a)});return w(t,e),t}function qt(e,r){var t=this,s=new h(function(a,n){if(e<0){a(null);return}t.ready().then(function(){H(t._dbInfo,te,function(u,l){if(u)return n(u);try{var f=l.objectStore(t._dbInfo.storeName),p=!1,y=f.openKeyCursor();y.onsuccess=function(){var b=y.result;if(!b){a(null);return}e===0||p?a(b.key):(p=!0,b.advance(e))},y.onerror=function(){n(y.error)}}catch(b){n(b)}})}).catch(n)});return w(s,r),s}function Dt(e){var r=this,t=new h(function(s,a){r.ready().then(function(){H(r._dbInfo,te,function(n,u){if(n)return a(n);try{var l=u.objectStore(r._dbInfo.storeName),f=l.openKeyCursor(),p=[];f.onsuccess=function(){var y=f.result;if(!y){s(p);return}p.push(y.key),y.continue()},f.onerror=function(){a(f.error)}}catch(y){a(y)}})}).catch(a)});return w(t,e),t}function Ft(e,r){r=F.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var s=this,a;if(!e.name)a=h.reject("Invalid arguments");else{var n=e.name===t.name&&s._dbInfo.db,u=n?h.resolve(s._dbInfo.db):K(e).then(function(l){var f=M[e.name],p=f.forages;f.db=l;for(var y=0;y<p.length;y++)p[y]._dbInfo.db=l;return l});e.storeName?a=u.then(function(l){if(l.objectStoreNames.contains(e.storeName)){var f=l.version+1;U(e);var p=M[e.name],y=p.forages;l.close();for(var b=0;b<y.length;b++){var E=y[b];E._dbInfo.db=null,E._dbInfo.version=f}var x=new h(function(N,L){var B=T.open(e.name,f);B.onerror=function(W){var ue=B.result;ue.close(),L(W)},B.onupgradeneeded=function(){var W=B.result;W.deleteObjectStore(e.storeName)},B.onsuccess=function(){var W=B.result;W.close(),N(W)}});return x.then(function(N){p.db=N;for(var L=0;L<y.length;L++){var B=y[L];B._dbInfo.db=N,z(B._dbInfo)}}).catch(function(N){throw(G(e,N)||h.resolve()).catch(function(){}),N})}}):a=u.then(function(l){U(e);var f=M[e.name],p=f.forages;l.close();for(var y=0;y<p.length;y++){var b=p[y];b._dbInfo.db=null}var E=new h(function(x,N){var L=T.deleteDatabase(e.name);L.onerror=function(){var B=L.result;B&&B.close(),N(L.error)},L.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},L.onsuccess=function(){var B=L.result;B&&B.close(),x(B)}});return E.then(function(x){f.db=x;for(var N=0;N<p.length;N++){var L=p[N];z(L._dbInfo)}}).catch(function(x){throw(G(e,x)||h.resolve()).catch(function(){}),x})})}return w(a,r),a}var Bt={_driver:"asyncStorage",_initStorage:Ct,_support:C(),iterate:Rt,getItem:Pt,setItem:xt,removeItem:Nt,clear:Ot,length:kt,key:qt,keys:Dt,dropInstance:Ft};function Lt(){return typeof openDatabase=="function"}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt="~~local_forage_type~",ze=/^~~local_forage_type~([^~]+)~/,he="__lfsc__:",Se=he.length,Te="arbf",Ce="blob",Ge="si08",Ye="ui08",We="uic8",Ve="si16",Xe="si32",Ke="ur16",He="ui32",Je="fl32",Qe="fl64",Ze=Se+Te.length,et=Object.prototype.toString;function tt(e){var r=e.length*.75,t=e.length,s,a=0,n,u,l,f;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var p=new ArrayBuffer(r),y=new Uint8Array(p);for(s=0;s<t;s+=4)n=J.indexOf(e[s]),u=J.indexOf(e[s+1]),l=J.indexOf(e[s+2]),f=J.indexOf(e[s+3]),y[a++]=n<<2|u>>4,y[a++]=(u&15)<<4|l>>2,y[a++]=(l&3)<<6|f&63;return p}function Pe(e){var r=new Uint8Array(e),t="",s;for(s=0;s<r.length;s+=3)t+=J[r[s]>>2],t+=J[(r[s]&3)<<4|r[s+1]>>4],t+=J[(r[s+1]&15)<<2|r[s+2]>>6],t+=J[r[s+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function Mt(e,r){var t="";if(e&&(t=et.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&et.call(e.buffer)==="[object ArrayBuffer]")){var s,a=he;e instanceof ArrayBuffer?(s=e,a+=Te):(s=e.buffer,t==="[object Int8Array]"?a+=Ge:t==="[object Uint8Array]"?a+=Ye:t==="[object Uint8ClampedArray]"?a+=We:t==="[object Int16Array]"?a+=Ve:t==="[object Uint16Array]"?a+=Ke:t==="[object Int32Array]"?a+=Xe:t==="[object Uint32Array]"?a+=He:t==="[object Float32Array]"?a+=Je:t==="[object Float64Array]"?a+=Qe:r(new Error("Failed to get type for BinaryArray"))),r(a+Pe(s))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var u=jt+e.type+"~"+Pe(this.result);r(he+Ce+u)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(u){console.error("Couldn't convert value into a JSON string: ",e),r(null,u)}}function Ut(e){if(e.substring(0,Se)!==he)return JSON.parse(e);var r=e.substring(Ze),t=e.substring(Se,Ze),s;if(t===Ce&&ze.test(r)){var a=r.match(ze);s=a[1],r=r.substring(a[0].length)}var n=tt(r);switch(t){case Te:return n;case Ce:return O([n],{type:s});case Ge:return new Int8Array(n);case Ye:return new Uint8Array(n);case We:return new Uint8ClampedArray(n);case Ve:return new Int16Array(n);case Ke:return new Uint16Array(n);case Xe:return new Int32Array(n);case He:return new Uint32Array(n);case Je:return new Float32Array(n);case Qe:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var Re={serialize:Mt,deserialize:Ut,stringToBuffer:tt,bufferToString:Pe};function rt(e,r,t,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,s)}function $t(e){var r=this,t={db:null};if(e)for(var s in e)t[s]=typeof e[s]!="string"?e[s].toString():e[s];var a=new h(function(n,u){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(l){return u(l)}t.db.transaction(function(l){rt(l,t,function(){r._dbInfo=t,n()},function(f,p){u(p)})},u)});return t.serializer=Re,a}function Q(e,r,t,s,a,n){e.executeSql(t,s,a,function(u,l){l.code===l.SYNTAX_ERR?u.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(f,p){p.rows.length?n(f,l):rt(f,r,function(){f.executeSql(t,s,a,n)},n)},n):n(u,l)},n)}function zt(e,r){var t=this;e=k(e);var s=new h(function(a,n){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){Q(l,u,"SELECT * FROM "+u.storeName+" WHERE key = ? LIMIT 1",[e],function(f,p){var y=p.rows.length?p.rows.item(0).value:null;y&&(y=u.serializer.deserialize(y)),a(y)},function(f,p){n(p)})})}).catch(n)});return w(s,r),s}function Gt(e,r){var t=this,s=new h(function(a,n){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){Q(l,u,"SELECT * FROM "+u.storeName,[],function(f,p){for(var y=p.rows,b=y.length,E=0;E<b;E++){var x=y.item(E),N=x.value;if(N&&(N=u.serializer.deserialize(N)),N=e(N,x.key,E+1),N!==void 0){a(N);return}}a()},function(f,p){n(p)})})}).catch(n)});return w(s,r),s}function nt(e,r,t,s){var a=this;e=k(e);var n=new h(function(u,l){a.ready().then(function(){r===void 0&&(r=null);var f=r,p=a._dbInfo;p.serializer.serialize(r,function(y,b){b?l(b):p.db.transaction(function(E){Q(E,p,"INSERT OR REPLACE INTO "+p.storeName+" (key, value) VALUES (?, ?)",[e,y],function(){u(f)},function(x,N){l(N)})},function(E){if(E.code===E.QUOTA_ERR){if(s>0){u(nt.apply(a,[e,f,t,s-1]));return}l(E)}})})}).catch(l)});return w(n,t),n}function Yt(e,r,t){return nt.apply(this,[e,r,t,1])}function Wt(e,r){var t=this;e=k(e);var s=new h(function(a,n){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){Q(l,u,"DELETE FROM "+u.storeName+" WHERE key = ?",[e],function(){a()},function(f,p){n(p)})})}).catch(n)});return w(s,r),s}function Vt(e){var r=this,t=new h(function(s,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(u){Q(u,n,"DELETE FROM "+n.storeName,[],function(){s()},function(l,f){a(f)})})}).catch(a)});return w(t,e),t}function Xt(e){var r=this,t=new h(function(s,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(u){Q(u,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(l,f){var p=f.rows.item(0).c;s(p)},function(l,f){a(f)})})}).catch(a)});return w(t,e),t}function Kt(e,r){var t=this,s=new h(function(a,n){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){Q(l,u,"SELECT key FROM "+u.storeName+" WHERE id = ? LIMIT 1",[e+1],function(f,p){var y=p.rows.length?p.rows.item(0).key:null;a(y)},function(f,p){n(p)})})}).catch(n)});return w(s,r),s}function Ht(e){var r=this,t=new h(function(s,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(u){Q(u,n,"SELECT key FROM "+n.storeName,[],function(l,f){for(var p=[],y=0;y<f.rows.length;y++)p.push(f.rows.item(y).key);s(p)},function(l,f){a(f)})})}).catch(a)});return w(t,e),t}function Jt(e){return new h(function(r,t){e.transaction(function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(a,n){for(var u=[],l=0;l<n.rows.length;l++)u.push(n.rows.item(l).name);r({db:e,storeNames:u})},function(a,n){t(n)})},function(s){t(s)})})}function Qt(e,r){r=F.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var s=this,a;return e.name?a=new h(function(n){var u;e.name===t.name?u=s._dbInfo.db:u=openDatabase(e.name,"","",0),e.storeName?n({db:u,storeNames:[e.storeName]}):n(Jt(u))}).then(function(n){return new h(function(u,l){n.db.transaction(function(f){function p(x){return new h(function(N,L){f.executeSql("DROP TABLE IF EXISTS "+x,[],function(){N()},function(B,W){L(W)})})}for(var y=[],b=0,E=n.storeNames.length;b<E;b++)y.push(p(n.storeNames[b]));h.all(y).then(function(){u()}).catch(function(x){l(x)})},function(f){l(f)})})}):a=h.reject("Invalid arguments"),w(a,r),a}var Zt={_driver:"webSQLStorage",_initStorage:$t,_support:Lt(),iterate:Gt,getItem:zt,setItem:Yt,removeItem:Wt,clear:Vt,length:Xt,key:Kt,keys:Ht,dropInstance:Qt};function er(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function st(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function tr(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function rr(){return!tr()||localStorage.length>0}function nr(e){var r=this,t={};if(e)for(var s in e)t[s]=e[s];return t.keyPrefix=st(e,r._defaultConfig),rr()?(r._dbInfo=t,t.serializer=Re,h.resolve()):h.reject()}function sr(e){var r=this,t=r.ready().then(function(){for(var s=r._dbInfo.keyPrefix,a=localStorage.length-1;a>=0;a--){var n=localStorage.key(a);n.indexOf(s)===0&&localStorage.removeItem(n)}});return w(t,e),t}function ar(e,r){var t=this;e=k(e);var s=t.ready().then(function(){var a=t._dbInfo,n=localStorage.getItem(a.keyPrefix+e);return n&&(n=a.serializer.deserialize(n)),n});return w(s,r),s}function ir(e,r){var t=this,s=t.ready().then(function(){for(var a=t._dbInfo,n=a.keyPrefix,u=n.length,l=localStorage.length,f=1,p=0;p<l;p++){var y=localStorage.key(p);if(y.indexOf(n)===0){var b=localStorage.getItem(y);if(b&&(b=a.serializer.deserialize(b)),b=e(b,y.substring(u),f++),b!==void 0)return b}}});return w(s,r),s}function or(e,r){var t=this,s=t.ready().then(function(){var a=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(a.keyPrefix.length)),n});return w(s,r),s}function ur(e){var r=this,t=r.ready().then(function(){for(var s=r._dbInfo,a=localStorage.length,n=[],u=0;u<a;u++){var l=localStorage.key(u);l.indexOf(s.keyPrefix)===0&&n.push(l.substring(s.keyPrefix.length))}return n});return w(t,e),t}function cr(e){var r=this,t=r.keys().then(function(s){return s.length});return w(t,e),t}function lr(e,r){var t=this;e=k(e);var s=t.ready().then(function(){var a=t._dbInfo;localStorage.removeItem(a.keyPrefix+e)});return w(s,r),s}function fr(e,r,t){var s=this;e=k(e);var a=s.ready().then(function(){r===void 0&&(r=null);var n=r;return new h(function(u,l){var f=s._dbInfo;f.serializer.serialize(r,function(p,y){if(y)l(y);else try{localStorage.setItem(f.keyPrefix+e,p),u(n)}catch(b){(b.name==="QuotaExceededError"||b.name==="NS_ERROR_DOM_QUOTA_REACHED")&&l(b),l(b)}})})});return w(a,t),a}function pr(e,r){if(r=F.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var s=this,a;return e.name?a=new h(function(n){e.storeName?n(st(e,s._defaultConfig)):n(e.name+"/")}).then(function(n){for(var u=localStorage.length-1;u>=0;u--){var l=localStorage.key(u);l.indexOf(n)===0&&localStorage.removeItem(l)}}):a=h.reject("Invalid arguments"),w(a,r),a}var dr={_driver:"localStorageWrapper",_initStorage:nr,_support:er(),iterate:ir,getItem:ar,setItem:fr,removeItem:lr,clear:sr,length:cr,key:or,keys:ur,dropInstance:pr},yr=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},hr=function(r,t){for(var s=r.length,a=0;a<s;){if(yr(r[a],t))return!0;a++}return!1},at=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},oe={},it={},se={INDEXEDDB:Bt,WEBSQL:Zt,LOCALSTORAGE:dr},mr=[se.INDEXEDDB._driver,se.WEBSQL._driver,se.LOCALSTORAGE._driver],me=["dropInstance"],xe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(me),vr={description:"",driver:mr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function gr(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function Ne(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(at(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var br=function(){function e(r){A(this,e);for(var t in se)if(se.hasOwnProperty(t)){var s=se[t],a=s._driver;this[t]=a,oe[a]||this.defineDriver(s)}this._defaultConfig=Ne({},vr),this._config=Ne({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":_(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var s in t){if(s==="storeName"&&(t[s]=t[s].replace(/\W/g,"_")),s==="version"&&typeof t[s]!="number")return new Error("Database version must be a number.");this._config[s]=t[s]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,s,a){var n=new h(function(u,l){try{var f=t._driver,p=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){l(p);return}for(var y=xe.concat("_initStorage"),b=0,E=y.length;b<E;b++){var x=y[b],N=!hr(me,x);if((N||t[x])&&typeof t[x]!="function"){l(p);return}}var L=function(){for(var ue=function(Ir){return function(){var Er=new Error("Method "+Ir+" is not implemented by the current driver"),ot=h.reject(Er);return w(ot,arguments[arguments.length-1]),ot}},Oe=0,wr=me.length;Oe<wr;Oe++){var ke=me[Oe];t[ke]||(t[ke]=ue(ke))}};L();var B=function(ue){oe[f]&&console.info("Redefining LocalForage driver: "+f),oe[f]=t,it[f]=ue,u()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(B,l):B(!!t._support):B(!0)}catch(W){l(W)}});return P(n,s,a),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,s,a){var n=oe[t]?h.resolve(oe[t]):h.reject(new Error("Driver not found."));return P(n,s,a),n},e.prototype.getSerializer=function(t){var s=h.resolve(Re);return P(s,t),s},e.prototype.ready=function(t){var s=this,a=s._driverSet.then(function(){return s._ready===null&&(s._ready=s._initDriver()),s._ready});return P(a,t,t),a},e.prototype.setDriver=function(t,s,a){var n=this;at(t)||(t=[t]);var u=this._getSupportedDrivers(t);function l(){n._config.driver=n.driver()}function f(b){return n._extend(b),l(),n._ready=n._initStorage(n._config),n._ready}function p(b){return function(){var E=0;function x(){for(;E<b.length;){var N=b[E];return E++,n._dbInfo=null,n._ready=null,n.getDriver(N).then(f).catch(x)}l();var L=new Error("No available storage method found.");return n._driverSet=h.reject(L),n._driverSet}return x()}}var y=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=y.then(function(){var b=u[0];return n._dbInfo=null,n._ready=null,n.getDriver(b).then(function(E){n._driver=E._driver,l(),n._wrapLibraryMethodsWithReady(),n._initDriver=p(u)})}).catch(function(){l();var b=new Error("No available storage method found.");return n._driverSet=h.reject(b),n._driverSet}),P(this._driverSet,s,a),this._driverSet},e.prototype.supports=function(t){return!!it[t]},e.prototype._extend=function(t){Ne(this,t)},e.prototype._getSupportedDrivers=function(t){for(var s=[],a=0,n=t.length;a<n;a++){var u=t[a];this.supports(u)&&s.push(u)}return s},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,s=xe.length;t<s;t++)gr(this,xe[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),_r=new br;d.exports=_r},{3:3}]},{},[4])(4)})});var $r={};xr($r,{default:()=>we});module.exports=Or($r);var Ie=require("obsidian");var kr=class extends Error{issues;constructor(o){super(o[0].message),this.name="ValiError",this.issues=o}},Yr=Symbol("brand");function qr(o){return typeof o=="function"?o():o}function ae(o,i){return Array.isArray(o)?[void 0,o]:[o,i]}function qe(o,i,c){return{typed:o,output:i,issues:c}}function Dr(o,i,c){if(!o||typeof o=="object"&&!Array.isArray(o)){let[m,_]=ae(i,c);return[o,m,_]}let[v,d]=ae(o,i);return[void 0,v,d]}function Fr(o,i){return{reason:o?.reason,validation:i.validation,origin:o?.origin||"value",message:i.message,input:i.input,requirement:i?.requirement,path:i.path,abortEarly:o?.abortEarly,abortPipeEarly:o?.abortPipeEarly,skipPipe:o?.skipPipe}}function Br(o,i){return{reason:i,origin:o?.origin,abortEarly:o?.abortEarly,abortPipeEarly:o?.abortPipeEarly,skipPipe:o?.skipPipe}}function ce(o,i,c,v,d){let m,_=o;if(i?.length&&!c?.skipPipe)for(let A of i){let I=A._parse(_);if(I.issues){m=m||Br(c,v);for(let T of I.issues){let C=Fr(m,T);d?d.push(C):d=[C]}if(m.abortEarly||m.abortPipeEarly)break}else _=I.output}return qe(!0,_,d)}function le(o,i,c,v,d,m,_){return{typed:!1,output:d,issues:[{reason:i,validation:c,origin:o?.origin||"value",message:qr(v),input:d,path:m,issues:_,abortEarly:o?.abortEarly,abortPipeEarly:o?.abortPipeEarly,skipPipe:o?.skipPipe}]}}function De(o,i,c){let[v="Invalid type",d]=ae(i,c);return{type:"array",async:!1,item:o,message:v,pipe:d,_parse(m,_){if(!Array.isArray(m))return le(_,"type","array",this.message,m);let A=!0,I,T=[];for(let C=0;C<m.length;C++){let O=m[C],h=this.item._parse(O,_);if(h.issues){let w={type:"array",input:m,key:C,value:O};for(let P of h.issues)P.path?P.path.unshift(w):P.path=[w],I?.push(P);if(I||(I=h.issues),_?.abortEarly){A=!1;break}}h.typed||(A=!1),T.push(h.output)}return A?ce(T,this.pipe,_,"array",I):qe(!1,T,I)}}}function ct(o,i){let[c="Invalid type",v]=ae(o,i);return{type:"boolean",async:!1,message:c,pipe:v,_parse(d,m){return typeof d!="boolean"?le(m,"type","boolean",this.message,d):ce(d,this.pipe,m,"boolean")}}}function lt(o,i){let[c="Invalid type",v]=ae(o,i);return{type:"number",async:!1,message:c,pipe:v,_parse(d,m){return typeof d!="number"||isNaN(d)?le(m,"type","number",this.message,d):ce(d,this.pipe,m,"number")}}}function Fe(o,i,c,v){let[d,m="Invalid type",_]=Dr(i,c,v),A;return{type:"object",async:!1,entries:o,rest:d,message:m,pipe:_,_parse(I,T){if(!I||typeof I!="object")return le(T,"type","object",this.message,I);A=A||Object.entries(this.entries);let C=!0,O,h={};for(let[w,P]of A){let k=I[w],F=P._parse(k,T);if(F.issues){let q={type:"object",input:I,key:w,value:k};for(let $ of F.issues)$.path?$.path.unshift(q):$.path=[q],O?.push($);if(O||(O=F.issues),T?.abortEarly){C=!1;break}}F.typed||(C=!1),(F.output!==void 0||w in I)&&(h[w]=F.output)}if(this.rest&&!(T?.abortEarly&&O)){for(let w in I)if(!(w in this.entries)){let P=I[w],k=this.rest._parse(P,T);if(k.issues){let F={type:"object",input:I,key:w,value:P};for(let q of k.issues)q.path?q.path.unshift(F):q.path=[F],O?.push(q);if(O||(O=k.issues),T?.abortEarly){C=!1;break}}k.typed||(C=!1),h[w]=k.output}}return C?ce(h,this.pipe,T,"object",O):qe(!1,h,O)}}}function Z(o,i){let[c="Invalid type",v]=ae(o,i);return{type:"string",async:!1,message:c,pipe:v,_parse(d,m){return typeof d!="string"?le(m,"type","string",this.message,d):ce(d,this.pipe,m,"string")}}}async function ft(o,i,c){let v=await o._parse(i,c);return{typed:v.typed,success:!v.issues,data:v.output,output:v.output,error:v.issues&&new kr(v.issues),issues:v.issues}}var ee=require("obsidian");var yt=Nr(dt()),Lr=yt.createInstance({name:"Obsidian-TinyPNG-Image-Plugin_DEFAULT_STORE"}),V=Lr;var Hr=Fe({tinypngApiKey:Z(),tinypngBaseUrl:Z(),concurrency:lt(),compressAllowedFoldersOnly:ct(),cacheFilePath:Z(),allowedFolders:De(Z()),ignoredFolders:De(Z())}),ht=Fe({_NOTICE:Z(),j:Z()});async function Le(o,i){return await o.vault.adapter.exists(i.cacheFilePath)||await o.vault.create(i.cacheFilePath,"{}"),i.cacheFilePath}function mt(o){return`${encodeURIComponent(o.name)}-${String(o.stat.size)}`}async function vt(o,i,c){let v=await Le(o,i),d=await o.vault.adapter.read(v);return JSON.parse(d)[mt(c)]===1}async function ge(o,i,c){let v=await Le(o,i),d=await o.vault.adapter.read(v),m=JSON.parse(d);m[mt(c)]=1,await o.vault.adapter.write(v,JSON.stringify(m));let _=await V.getItem("imagesNumberAwaitingCompression");if(_){let A=Number(_)-1;await(A>0?V.setItem("imagesNumberAwaitingCompression",A):V.removeItem("imagesNumberAwaitingCompression"))}}async function gt(o,i){let c=await Le(o,i);await o.vault.adapter.write(c,"{}")}function fe(o){let c=o.app.vault.getFiles().filter(v=>{let d=v.extension,m=d==="png"||d==="jpg"||d==="jpeg",_=o.settings.ignoredFolders.some(A=>v.path.startsWith(A));return o.settings.compressAllowedFoldersOnly&&(_=!o.settings.allowedFolders.some(A=>v.path.startsWith(A))),m&&!_});return console.log(c),c}async function Mr(o,i,c){console.log(i);try{if(await vt(o,i,c))return 1;let v=`${i.tinypngBaseUrl}/shrink`,d=btoa(`api:${i.tinypngApiKey}`),m=await(0,ee.request)({url:v,method:"POST",headers:{Authorization:`Basic ${d}`},body:await o.vault.readBinary(c)}),_=JSON.parse(m).output.url;if(!_)return 99;let A=await(0,ee.requestUrl)(_);return await o.vault.modifyBinary(c,A.arrayBuffer),await ge(o,i,c),0}catch(v){return v instanceof Error&&console.error(v.message),99}}async function je(o,i,c){if(!i.tinypngApiKey){new ee.Notice("Please enter an API key in the settings.");return}if(await V.getItem("compressionStatus")===1){let C=await V.getItem("imagesNumberAwaitingCompression");new ee.Notice(C?`There are ${C} images awaiting compression.`:"Compression is already in progress.");return}await V.setItem("compressionStatus",1),await V.setItem("imagesNumberAwaitingCompression",c.length);let m=i.concurrency,_=0,A=0,I=0,T=[];for(let C of c)T.push(Mr(o,i,C).then(O=>{switch(O){case 0:{_++;break}case 1:{A++;break}case 99:{I++;break}}}).catch(O=>{console.error(O),I++})),T.length>=m&&(await Promise.all(T),T.length=0);await Promise.all(T),await V.setItem("compressionStatus",0),new ee.Notice(`Compression complete. Success: ${_}, Ignored: ${A}, Failed: ${I}`)}var bt="DANGEROUS_DO_NOT_DELETE-tinypng-image-cache.json",Me="7gT#5Z@8L^1pQ&3J*6K$9V+0bD%2eR!4fY";var _t=o=>[...o].reverse().join(""),wt=(o,i)=>[...o].map((c,v)=>String.fromCharCode(c.charCodeAt(0)^i.charCodeAt(v%i.length))).join(""),It=o=>{if(!o?.j)return;let i=o.j;return i=_t(i),i=wt(i,Me),JSON.parse(i)},Et=o=>{if(o==null)return;let i=JSON.stringify(o);return i=wt(i,Me),i=_t(i),{_NOTICE:"DO NOT MODIFY THIS CONFIGURATION OR SHARE IT WITH ANYONE. IT SHOULD BE KEPT SECRET AND SECURE AT ALL TIMES. FAILURE TO COMPLY MAY DISRUPT THE FUNCTIONALITY OF THE SYSTEM.",j:i}};var j=require("obsidian");var pe={author:"ckt1031",authorUrl:"https://github.com/ckt1031",description:"Compress images using TinyPNG to save your storage.",id:"tinypng-image",isDesktopOnly:!1,minAppVersion:"1.0.0",name:"TinyPNG Image",version:"0.2.0"};var X=require("obsidian");var de=class extends X.Modal{constructor(i,c){super(i.app),this.path="",this.plugin=i,this.mode=c}getObject(){return this.mode==="allowed"?this.plugin.settings.allowedFolders:this.plugin.settings.ignoredFolders}async submitForm(){if(this.path===""){new X.Notice("Please fill out all fields");return}if(this.getObject().includes(this.path)){new X.Notice(`Path already exists in ${this.mode} folders`);return}if(!await this.plugin.app.vault.adapter.exists(this.path)){new X.Notice("Path does not exist");return}this.getObject().push(this.path),await this.plugin.saveSettings(),new X.Notice(`Added ${this.path} to ${this.mode} folders`),this.close()}onOpen(){let{contentEl:i,path:c}=this;i.createEl("h4",{text:`Add ${this.mode} Folder`}),new X.Setting(i).setName("Path:").addText(v=>{v.onChange(d=>{this.path=d}),v.setValue(c)}),new X.Setting(i).addButton(v=>v.setButtonText("Confirm").setCta().onClick(async()=>{await this.submitForm()}))}async onClose(){let{contentEl:i,plugin:c}=this;i.empty(),await c.app.setting.open(),await c.app.setting.openTabById(pe.id)}};var be=require("obsidian"),re=class extends be.Modal{constructor(i,c,v){super(i),this.onConfirm=c,v&&(this.onCancel=v)}onOpen(){let{contentEl:i,onCancel:c}=this;i.createEl("h4",{text:"Are you sure you want to proceed?"}),i.createEl("p",{text:"This action cannot be undone, please confirm to proceed."}),new be.Setting(i).addButton(v=>v.setButtonText("Confirm").setCta().onClick(async()=>{this.close(),await this.onConfirm()})).addButton(v=>v.setButtonText("Cancel").setCta().onClick(async()=>{this.close(),c&&await c()}))}onClose(){let{contentEl:i}=this;i.empty()}};var _e=class o extends j.PluginSettingTab{constructor(i,c){super(i,c),this.plugin=c}static{this.createFragmentWithHTML=i=>createFragment(c=>{let v=c.createDiv();v.innerHTML=i})}display(){let{containerEl:i,plugin:c,app:v}=this;if(i.empty(),i.createEl("h1",{text:pe.name}),new j.Setting(i).setName("API Key").setDesc(o.createFragmentWithHTML('API Key for the tinypng service, you can get one <a href="https://tinify.com/dashboard/api" target="_blank">here</a>')).addText(d=>d.setPlaceholder("Enter your secret").setValue(c.settings.tinypngApiKey).onChange(async m=>{c.settings.tinypngApiKey=m,await c.saveSettings()})),new j.Setting(i).setName("TinyPNG Base URL").setDesc(o.createFragmentWithHTML("Base URL for the tinypng service, defaults to <code>https://api.tinify.com</code>")).addText(d=>d.setPlaceholder("Enter your base URL").setValue(c.settings.tinypngBaseUrl).onChange(async m=>{c.settings.tinypngBaseUrl=m,await c.saveSettings()})),new j.Setting(i).setName("Compress Allowed Folders Only").setDesc("Compress the allowed folder only. If no, then it will compress all folders except ignored folders.").addToggle(d=>{d.setValue(c.settings.compressAllowedFoldersOnly).onChange(async m=>{c.settings.compressAllowedFoldersOnly=m,await c.saveSettings(),await c.app.setting.close(),await c.app.setting.openTabById(pe.id)})}),new j.Setting(i).setName("Concurrency").setDesc("Number of images to compress at once").addDropdown(d=>{d.addOption("1","1").addOption("5","5 (Default)").addOption("10","10").addOption("20","20").addOption("50","50 (High CPU Usage)").setValue(c.settings.concurrency.toString()).onChange(async m=>{c.settings.concurrency=Number.parseInt(m),await c.saveSettings()})}),new j.Setting(i).setName("Cache File Path").setDesc(o.createFragmentWithHTML("<b>DANGER:</b> This setting is for advanced users. Changing the cache file path can lead to data inconsistencies and redundant API calls. If you change this path, make sure to manually copy the cache file to the new location.")).addText(d=>{d.setPlaceholder("Enter the path for the cache file").setValue(c.settings.cacheFilePath).onChange(async m=>{c.settings.cacheFilePath=m,await c.saveSettings()})}),new j.Setting(i).setName("Reset Local Store").setDesc(o.createFragmentWithHTML("<b>This is a debug option!</b> This will reset the local store, which can fix some temporary issues.")).addButton(d=>{d.setButtonText("Reset").onClick(()=>{new re(v,async()=>{await V.clear(),new j.Notice("Local store has been reset")}).open()})}),new j.Setting(i).setName("Save all image to cache without compression").setDesc(o.createFragmentWithHTML("<b>This is a debug option!</b> If you are certain that all images are compressed and you have lost the cache file, you can use this option to temporarily recover the cache file.")).addButton(d=>{d.setButtonText("Reset").onClick(()=>{new re(v,async()=>{let m=fe(c);for(let _ of m)await ge(v,c.settings,_);new j.Notice("All images have been added to the cache")}).open()})}),new j.Setting(i).setName("Clear all images records from cache").setDesc(o.createFragmentWithHTML("<b>This is a debug and VERY DANGEROUS option!</b> You will lose all the records of the images that have been compressed. This will not delete the images themselves, but you will be compressing them again.")).addButton(d=>{d.setButtonText("Reset").onClick(()=>{new re(v,async()=>{await gt(v,c.settings),new j.Notice("All images have been removed from the cache")}).open()})}),c.settings.compressAllowedFoldersOnly){i.createEl("h2",{text:"Allowed Folders"}),new j.Setting(i).setName("Add").setDesc("Add a folder to the allowed folders list").addButton(d=>{d.setButtonText("Add").onClick(async()=>{await c.app.setting.close(),new de(c,"allowed").open()})});for(let d of c.settings.allowedFolders)new j.Setting(i).setName(d).addButton(m=>{m.setIcon("cross"),m.setTooltip("Delete this folder from the allowed folders list"),m.onClick(async()=>{m.buttonEl.textContent===""?(m.setButtonText("Click once more to confirm removal"),setTimeout(()=>{m.setIcon("cross")},5e3)):(m.buttonEl.parentElement?.parentElement&&m.buttonEl.parentElement.parentElement.remove(),c.settings.allowedFolders=c.settings.allowedFolders.filter(_=>_!==d),await c.saveSettings())})})}i.createEl("h2",{text:"Ignored Folders"}),new j.Setting(i).setName("Add").setDesc("Add a folder to the ignored folders list").addButton(d=>{d.setButtonText("Add").onClick(async()=>{await c.app.setting.close(),new de(c,"ignored").open()})});for(let d of c.settings.ignoredFolders)new j.Setting(i).setName(d).addButton(m=>{m.setIcon("cross"),m.setTooltip("Delete this folder from the ignored folders list"),m.onClick(async()=>{m.buttonEl.textContent===""?(m.setButtonText("Click once more to confirm removal"),setTimeout(()=>{m.setIcon("cross")},5e3)):(m.buttonEl.parentElement?.parentElement&&m.buttonEl.parentElement.parentElement.remove(),c.settings.ignoredFolders=c.settings.ignoredFolders.filter(_=>_!==d),await c.saveSettings())})})}};var At={tinypngApiKey:"",tinypngBaseUrl:"https://api.tinify.com",concurrency:5,ignoredFolders:[],allowedFolders:[],cacheFilePath:bt,compressAllowedFoldersOnly:!1},we=class extends Ie.Plugin{async onload(){await this.loadSettings(),(0,Ie.addIcon)("compress",`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<path d="M12 5v14M19 12l-7 7-7-7"/>
		</svg>
'`),this.addRibbonIcon("compress","Compress images",async()=>{let i=fe(this);await je(this.app,this.settings,i)}),this.addCommand({id:"compress-images",name:"Compress images in the current vault",callback:async()=>{let i=fe(this);await je(this.app,this.settings,i)}}),this.addSettingTab(new _e(this.app,this))}onunload(){}async loadSettings(){let i=await this.loadData(),{success:c}=await ft(ht,i);if(!c){this.settings=At,console.log("Failed to parse settings, using defaults.");return}this.settings=Object.assign({},At,It(i))}async saveSettings(){await this.saveData(Et(this.settings))}};

/* nosourcemap */